<!DOCTYPE html>
<html lang="en" style="--bg:hsl(20, 60%, 80%);">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon" type="image/png" href="https://cpwebassets.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png">
        <meta name="apple-mobile-web-app-title" content="CodePen">
        <link rel="shortcut icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico">
        <link rel="mask-icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-8f3771b1072e3c38bd662872f6b673a722f4b3ca2421637d5596661b4e2132cc.svg" color="#111">
        <title>Drag slider</title>
        <style>
            *,*:after,*:before {
            box-sizing: border-box;
            }
            body {
            min-height: 100vh;
            display: grid;
            place-items: center;
            overflow-y: hidden;
            background: var(--bg);
            }
            .drag-proxy {
            visibility: hidden;
            position: absolute;
            }
            ul {
            height: 100vh;
            width: 100%;
            overflow: hidden;
            position: absolute;
            transform-style: preserve-3d;
            perspective: 800px;
            touch-action: none;
            padding: 0;
            margin: 0;
            }
            li {
            position: absolute;
            transform-style: preserve-3d;
            top: 50%;
            left: 50%;
            height: 30vmin;
            width: 30vmin;
            min-height: 150px;
            min-width: 150px;
            display: none;
            background: #b3f075;
            }
            img {
            position: absolute;
            height: 100%;
            width: 100%;
            object-fit: cover;
            }
        </style>
    </head>
    <body translate="no" style="overflow-y: scroll;">
        <div class="pin-spacer" style="order: 0; place-self: auto; grid-area: auto / auto / auto / auto; z-index: auto; float: none; flex-shrink: 1; display: block; margin: 0px; inset: 8px 0px -8px; position: absolute; flex-basis: auto; overflow: visible; box-sizing: border-box; width: 841px; height: 2157px; padding: 0px 0px 2000px;">
            <ul style="transform: translate(0px, 0px); left: 0px; top: 8.001px; margin: 0px; max-width: 842px; width: 842px; max-height: 158px; height: 158px; padding: 0px; box-sizing: border-box; position: fixed;">
                <li class="a" style="transform: translate(-50%, -50%) translate3d(0px, 0px, 100px); filter: grayscale(0); opacity: 1; z-index: 16; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/ezSFnAFi9hY/500x500" alt="cut citrus fruits." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Lorem Ipsum</span></li>
                <li class="b" style="transform: translate(40%, -47.3618%) translate3d(0px, 0px, 0px) rotate(5.7436deg) rotateY(-58.9606deg) rotateX(-54.3008deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 13; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/TIGDsyy0TK4/500x500" alt="sliced mango." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Dolor Sit</span></li>
                <li class="c" style="transform: translate(110%, -43.31%) translate3d(0px, 0px, 0px) rotate(-5.2398deg) rotateY(-214.343deg) rotateX(153.703deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 10; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/TdDtTu2rv4s/500x500" alt="a bunch of blueberries." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Amet Consectetur</span></li>
                <li class="d" style="transform: translate(160%, 21.1097%) translate3d(0px, 0px, 0px) rotate(123.923deg) rotateY(-92.3211deg) rotateX(116.572deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 7; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/eudGUrDdBB0/500x500" alt="a pineapple sitting on a table." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Adipiscing Elit</span></li>
                <li class="e" style="transform: translate(190%, -77.7396%) translate3d(0px, 0px, 0px) rotate(-89.6094deg) rotateY(167.451deg) rotateX(-326.266deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 4; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/eJH4f1rlG7g/500x500" alt="frozen raspberries." style="touch-action: pan-y;"><span style="touch-action: pan-y;"> Nunc Tortor</span></li>
                <li class="f" style="transform: translate(-300%, -144.088%) rotate(-44.0884deg) rotateY(58.7507deg) rotateX(-168.767deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/24RUrLSW1HI/500x500" alt="a sliced strawberry." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Metus Mollis</span></li>
                <li class="g" style="transform: translate(-300%, -147.589%) rotate(-47.5895deg) rotateY(48.1306deg) rotateX(-51.7004deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/h5yMpgOI5nI/500x500" alt="an arrangement of assorted sliced fruits." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Congue Sagittis</span></li>
                <li class="h" style="transform: translate(-300%, -37.5211%) rotate(62.4789deg) rotateY(130.391deg) rotateX(-128.553deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/2TYrR2IB72s/500x500" alt="sliced watermelons." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Vestibulum Et</span></li>
                <li class="i" style="transform: translate(-300%, -129.201%) rotate(-29.2009deg) rotateY(29.7016deg) rotateX(189.048deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/1cWZgnBhZRs/500x500" alt="grapefruits, lemons, and pomegranates." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Donec Eget</span></li>
                <li class="j" style="transform: translate(-300%, -135.097%) rotate(-35.097deg) rotateY(-259.432deg) rotateX(203.11deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/9aOswReDKPo/500x500" alt="half of an avocado." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Maecenas et Justo</span></li>
                <li class="k" style="transform: translate(-300%, 32.6952%) rotate(132.695deg) rotateY(188.712deg) rotateX(27.6472deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/Nl7eLS8E2Ss/500x500" alt="half of a lime." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Malesuada Quam</span></li>
                <li class="l" style="transform: translate(-300%, -23.3507%) rotate(76.6493deg) rotateY(92.8544deg) rotateX(-218.497deg) scale(0.1, 0.1); filter: grayscale(1); opacity: 0; z-index: 1; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/3HhXWJzG5Ko/500x500" alt="a single cherry with stem." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Ultricies Sollicitudin</span></li>
                <li class="m" style="transform: translate(-290%, -159.861%) rotate(-61.8611deg) rotateY(-0.1756deg) rotateX(244.853deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 4; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/fczCr7MdE7U/500x500" alt="a bunch of bananas." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Gravida Nibh</span></li>
                <li class="n" style="transform: translate(-260%, -50.1888%) translate3d(0px, 0px, 0px) rotate(41.8112deg) rotateY(101.036deg) rotateX(-42.9238deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 7; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/uI900SItAyY/500x500" alt="three pears." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Pellentesque Sapien</span></li>
                <li class="o" style="transform: translate(-210%, -79.2022%) translate3d(0px, 0px, 0px) rotate(2.7978deg) rotateY(-196.419deg) rotateX(-117.498deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 10; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/0AynZdszfz0/500x500" alt="a basket full of peaches next to a plate with sliced peaches." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Suspendisse Vel</span></li>
                <li class="p" style="transform: translate(-140%, -49.301%) translate3d(0px, 0px, 0px) rotate(18.699deg) rotateY(-22.1314deg) rotateX(-92.4945deg) scale(0.5, 0.5); filter: grayscale(1); opacity: 1; z-index: 13; display: block; touch-action: pan-y; cursor: grab; user-select: none;"><img src="https://source.unsplash.com/C6JhUKs9q8M/500x500" alt="a bowl of avocados." style="touch-action: pan-y;"><span style="touch-action: pan-y;">Mauris Consectetur</span></li>
            </ul>
        </div>
        <div class="drag-proxy"></div>
            <script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-1b93190375e9ccc259df3a57c1abc0e64599724ae30d7ea4c6877eb615f89387.js"></script>
            <script id="rendered-js" type="module">
                import gsap from 'https://cdn.skypack.dev/gsap';
                import ScrollTrigger from 'https://cdn.skypack.dev/gsap/ScrollTrigger';
                import Draggable from 'https://cdn.skypack.dev/gsap/Draggable';
                gsap.registerPlugin(ScrollTrigger);
                gsap.registerPlugin(Draggable);
                gsap.set('li', {
                yPercent: -50 });
                const STAGGER = 0.1;
                const DURATION = 1;
                const OFFSET = 0;
                const BOXES = gsap.utils.toArray('li');
                const LOOP = gsap.timeline({
                paused: true,
                repeat: -1,
                ease: 'none' });
                const X_START = 200;
                const X_FINISH = -300;
                const Y_START = -150;
                const Y_FINISH = 150;
                const BEHAVIORS = new Array(BOXES.length).
                fill().
                map(() => [
                gsap.utils.random(-360, 360),
                gsap.utils.random(-360, 360),
                gsap.utils.random(Y_START, Y_FINISH),
                gsap.utils.random(-360, 360)]);
                const HUES = [
                'hsl(20, 60%, 80%)',
                'hsl(35, 5%, 80%)',
                'hsl(240, 25%, 80%)',
                'hsl(45, 5%, 75%)',
                'hsl(320, 35%, 75%)',
                'hsl(160, 35%, 85%)',
                'hsl(42, 70%, 75%)',
                'hsl(10, 75%, 80%)',
                'hsl(90, 30%, 80%)',
                'hsl(330, 80%, 80%)',
                'hsl(106, 40%, 80%)',
                'hsl(0, 0%, 90%)',
                'hsl(50, 80%, 80%)',
                'hsl(20, 26%, 76%)',
                'hsl(30, 20%, 80%)',
                'hsl(90, 15%, 80%)'];
                const SHIFTS = [...BOXES, ...BOXES, ...BOXES];
                SHIFTS.forEach((BOX, index) => {
                const BOX_TL = gsap.
                timeline().
                set(BOX, {
                    xPercent: 250,
                    opacity: 0,
                    filter: 'grayscale(1)',
                    scale: 0.1,
                    yPercent: () => BEHAVIORS[index % BOXES.length][2],
                    rotateX: () => BEHAVIORS[index % BOXES.length][0],
                    rotateY: () => BEHAVIORS[index % BOXES.length][1] }).
                to(
                BOX,
                {
                    opacity: 1,
                    scale: 0.5,
                    duration: 0.1 },
                0).
                to(
                BOX,
                {
                    opacity: 0,
                    scale: 0.1,
                    duration: 0.1 },
                0.9).
                to(
                BOX,
                {
                    filter: 'grayScale(0)',
                    repeat: 1,
                    yoyo: true,
                    duration: 0.1 },
                0.4).
                fromTo(
                BOX,
                {
                    rotateX: () => BEHAVIORS[index % BOXES.length][0],
                    rotateY: () => BEHAVIORS[index % BOXES.length][1],
                    rotate: () => BEHAVIORS[index % BOXES.length][2] },
                {
                    immediateRender: false,
                    rotateX: () => BEHAVIORS[index % BOXES.length][0] * -1,
                    rotateY: () => BEHAVIORS[index % BOXES.length][1] * -1,
                    rotate: () => BEHAVIORS[index % BOXES.length][2] * -1,
                    duration: 1,
                    ease: 'power1.inOut' },
                0)
                .fromTo(
                BOX,
                {
                    xPercent: X_START },
                {
                    xPercent: X_FINISH,
                    duration: 1,
                    immediateRender: false,
                    ease: 'power1.inOut' },
                0).
                to(
                BOX,
                {
                    yPercent: -50,
                    duration: 0.5,
                    immediateRender: false },
                0).
                to(
                BOX,
                {
                    yPercent: () => (BEHAVIORS[index % BOXES.length][2] + 100) * -1,
                    immediateRender: false,
                    duration: 0.5 },
                0.5)
                .to(
                BOX,
                {
                    z: 100,
                    scale: 1,
                    duration: 0.1,
                    repeat: 1,
                    yoyo: true },

                0.4).
                fromTo(
                BOX,
                {
                    zIndex: 1 },
                {
                    zIndex: BOXES.length,
                    repeat: 1,
                    yoyo: true,
                    ease: 'none',
                    duration: 0.5,
                    immediateRender: false },
                0);
                LOOP.add(BOX_TL, index * STAGGER);
                });
                const CYCLE_DURATION = STAGGER * BOXES.length;
                const START_TIME = CYCLE_DURATION + DURATION * 0.5 + OFFSET;
                const LOOP_HEAD = gsap.fromTo(
                LOOP,
                {
                totalTime: START_TIME },
                {
                totalTime: `+=${CYCLE_DURATION}`,
                duration: 1,
                ease: 'none',
                repeat: -1,
                paused: true });
                const PLAYHEAD = {
                position: 0 };
                const POSITION_WRAP = gsap.utils.wrap(0, LOOP_HEAD.duration());
                const SCRUB = gsap.to(PLAYHEAD, {
                position: 0,
                onUpdate: () => {
                    LOOP_HEAD.totalTime(POSITION_WRAP(PLAYHEAD.position));
                },
                paused: true,
                duration: 0.25,
                ease: 'power3' });
                let iteration = 0;
                const TRIGGER = ScrollTrigger.create({
                start: 0,
                end: '+=2000',
                horizontal: false,
                pin: 'ul',
                onUpdate: self => {
                    const SCROLL = self.scroll();
                    if (SCROLL > self.end - 1) {
                    // Go forwards in time
                    WRAP(1, 1);
                    } else if (SCROLL < 1 && self.direction < 0) {
                    // Go backwards in time
                    WRAP(-1, self.end - 1);
                    } else {
                    const NEW_POS = (iteration + self.progress) * LOOP_HEAD.duration();
                    SCRUB.vars.position = NEW_POS;
                    SCRUB.invalidate().restart();
                    }
                } });
                const WRAP = (iterationDelta, scrollTo) => {
                iteration += iterationDelta;
                TRIGGER.scroll(scrollTo);
                TRIGGER.update();
                };
                const SNAP = gsap.utils.snap(1 / BOXES.length);
                const progressToScroll = (progress) =>
                gsap.utils.clamp(
                1,
                TRIGGER.end - 1,
                gsap.utils.wrap(0, 1, progress) * TRIGGER.end);
                const scrollToPosition = position => {
                const SNAP_POS = SNAP(position);
                const PROGRESS =
                (SNAP_POS - LOOP_HEAD.duration() * iteration) / LOOP_HEAD.duration();
                const SCROLL = progressToScroll(PROGRESS);
                if (PROGRESS >= 1 || PROGRESS < 0) return WRAP(Math.floor(PROGRESS), SCROLL);
                gsap.to(document.documentElement, {
                    '--bg': HUES[PROGRESS * BOXES.length] });
                TRIGGER.scroll(SCROLL);
                };
                gsap.set(document.documentElement, {
                '--bg': HUES[0] });
                ScrollTrigger.addEventListener('scrollEnd', () =>
                scrollToPosition(SCRUB.vars.position));
                const NEXT = () => scrollToPosition(SCRUB.vars.position - 1 / BOXES.length);
                const PREV = () => scrollToPosition(SCRUB.vars.position + 1 / BOXES.length);
                document.addEventListener('keydown', event => {
                if (event.code === 'ArrowLeft' || event.code === 'KeyA') NEXT();
                if (event.code === 'ArrowRight' || event.code === 'KeyD') PREV();
                });
                document.querySelector('ul').addEventListener('click', e => {
                const BOX = e.target.closest('li');
                if (BOX) {
                    let TARGET = BOXES.indexOf(BOX);
                    let CURRENT = gsap.utils.wrap(
                    0,
                    BOXES.length,
                    Math.floor(BOXES.length * SCRUB.vars.position));
                    let BUMP = TARGET - CURRENT;
                    if (TARGET > CURRENT && TARGET - CURRENT > BOXES.length * 0.5) {
                    BUMP = (BOXES.length - BUMP) * -1;
                    }
                    if (CURRENT > TARGET && CURRENT - TARGET > BOXES.length * 0.5) {
                    BUMP = BOXES.length + BUMP;
                    }
                    scrollToPosition(SCRUB.vars.position + BUMP * (1 / BOXES.length));
                }
                });
                gsap.set(BOXES, { display: 'block' });
                Draggable.create('.drag-proxy', {
                type: 'x',
                trigger: 'li',
                onPress() {
                    this.startOffset = SCRUB.vars.position;
                },
                onDrag() {
                    SCRUB.vars.position = this.startOffset + (this.startX - this.x) * 0.001;
                    SCRUB.invalidate().restart();
                },
                onDragEnd() {
                    scrollToPosition(SCRUB.vars.position);
                } });
            </script>
        <script>
            window.console = window.console || function(t) {};
        </script> 
        <script>
            if (document.location.search.match(/type=embed/gi)) {
              window.parent.postMessage("resize", "*");
            }
        </script>
    </body>
</html>